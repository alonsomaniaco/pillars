include templates/bricks

mixin crud-list
	table(class="table table-striped")
		thead
			tr
				each header in schema.headers
					th(ng-class="{'text-primary':listSort=='"+header+"'}")
						span(class="ng-hide glyphicon glyphicon-sort-by-attributes", ng-show="listSort=='"+header+"' && listOrder==1") &nbsp;
						span(class="ng-hide glyphicon glyphicon-sort-by-attributes-alt", ng-show="listSort=='"+header+"' && listOrder==-1") &nbsp;
						= t12n("schemas."+schema.id+".headers."+header)
				th

		tbody
			tr(ng-repeat="record in data.list")
				each header in schema.headers
					td="{{record."+header+"}}"
				td
					a(href="#/edit/{{record._id}}",class="btn btn-primary", role="button")
						span(class="glyphicon glyphicon-pencil")
						= " "+t12n("crud.list.edit")
					button(class="btn btn-danger navbar-btn", type='button', ng-click="removeElement(record._id)")
						span(class="glyphicon glyphicon-remove")
						= " "+t12n("crud.list.remove")
	button(class="btn btn-info", type='button', ng-click="more()", ng-hide="end")
		span(class="glyphicon glyphicon-forward")
		= " "+t12n("crud.list.see-more")

mixin crud-editor
	+schema(schema)

mixin navbar
	nav(class="navbar navbar-default navbar-fixed-top", role="navigation")
		.container-fluid
			.navbar-header
				button(type="button", class="navbar-toggle", data-toggle="collapse" data-target="#navbar-update")
					span(class="sr-only") Toggle navigation
					span(class="icon-bar")
					span(class="icon-bar")
					span(class="icon-bar")
				a(class="navbar-brand", href="") Pillars
			div(id="navbar-update" class="collapse navbar-collapse")
				ul.nav.navbar-nav
					button(ng-if="navsave", form="activeForm", type='submit', class="btn btn-primary navbar-btn")= t12n("crud.navbar.save")
				form(class="navbar-form navbar-left", role="search", ng-controller="crudListFilter")
					.form-group
						.input-group
							input(type="text", class="form-control", ng-change="applyFilter()",placeholder=t12n("crud.navbar.search"), ng-model="listFilter")
							.input-group-btn
								button(type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown")
									span(class="caret")
								ul(class="dropdown-menu",role="menu")
									each header, i in schema.headers
										li
											a(href="",ng-click="sortBy('"+header+"',1)")
												span(class="glyphicon glyphicon-sort-by-attributes") &nbsp;
												= t12n("schemas."+schema.id+".headers."+header)
										li
											a(href="",ng-click="sortBy('"+header+"',-1)")
												span(class="glyphicon glyphicon-sort-by-attributes-alt") &nbsp;
												= t12n("schemas."+schema.id+".headers."+header)
										if i<schema.headers.length-1
											li(role="presentation" class="divider")
				ul.nav.navbar-nav
					li: a(href="#/") 
						span(class="glyphicon glyphicon-list")
						= " "+t12n("crud.navbar.list")
					li: a(href="#/new") 
						span(class="glyphicon glyphicon-plus")
						= " "+t12n("crud.navbar.new")
				ul.nav.navbar-nav.navbar-right
					button(ng-if="navsave", class="btn btn-danger navbar-btn", type='button', ng-click="removeElement()")
						span(class="glyphicon glyphicon-remove")
						= " "+t12n("crud.navbar.remove")

		div(ng-show="loading",class="ng-show form-progressbar")
					div(class="progress progress-striped active ng-hide", ng-show="sending>0")
						.progress-bar.progress-bar-info(role="progressbar", aria-valuenow="45", aria-valuemin="0", aria-valuemax="100", style="width: {{sending}}%")
							span.sr-only= t12n("crud.sending")+" {{sending}}%"
					div(class="progress progress-striped active ng-hide", ng-show="receiving>0")
						.progress-bar.progress-bar-success(role="progressbar", aria-valuenow="45", aria-valuemin="0", aria-valuemax="100", style="width: {{receiving}}%")
							span.sr-only= t12n("crud.receiving")+" {{receiving}}%"





mixin datepicker
	input(type='text', class="ng-hide", name="{{datepickerName}}" ng-model="value")
	.row
		.col-date.col-md-6
			.input-group
				span.input-group-addon
					span.glyphicon.glyphicon-calendar
				input(type="text",class="form-control datepicker-year",ng-model="calendar.selection.year",ng-change="setDate()",placeholder="Year")
				select(ng-model="calendar.selection.month",ng-change="setDate()",class="form-control datepicker-month")
					option(ng-repeat="(mk, m) in localeDateTime.MONTH" value="{{mk}}") {{m}}
				input(type="text",class="form-control datepicker-date",ng-model="calendar.selection.date",ng-change="setDate()",placeholder="Date")
				span.input-group-addon.clear-button
					span(class="glyphicon glyphicon-remove",ng-click="clearDate()")
		.col-time.col-md-6
			.input-group
				span.input-group-addon
					span.glyphicon.glyphicon-time
					|  24h
				input(type="text",class="form-control datepicker-hours",ng-model="calendar.selection.hours",ng-change="setDate()",placeholder="H")
				span.input-group-addon.input-group-separator :
				input(type="text",class="form-control datepicker-minutes",ng-model="calendar.selection.minutes",ng-change="setDate()",placeholder="M")
				span.input-group-addon {{calendar.tz}}
	.calendar
		table.calendar-table.table.table-bordered
			tr(class="datepicker-header")
				th(colspan="7")
					span(class="datepicker-month")
						span(class="glyphicon glyphicon-chevron-left",ng-click="calendar.prevMonth()")
						span(class="name") {{localeDateTime.MONTH[calendar.month]}}
						span(class="glyphicon glyphicon-chevron-right",ng-click="calendar.nextMonth()")
					span(class="datepicker-year")
						span(class="glyphicon glyphicon-chevron-left",ng-click="calendar.prevYear()")
						span(class="name") {{calendar.year}}
						span(class="glyphicon glyphicon-chevron-right",ng-click="calendar.nextYear()")
			tr(class="datepicker-week")
				th(ng-repeat="wd in calendar.weekformat") {{localeDateTime.SHORTDAY[wd]}}
			tr(class="datepicker-days", ng-repeat="(wk, w) in calendar.days")
				td(ng-repeat="(dk, d) in w", ng-click="selectDate(d)", ng-class="{'bg-primary':calendar.isSelection(d),'text-info':calendar.isToday(d),'outMonth':d.month!=calendar.month}") {{d.date}}

mixin referencepicker
	input(type='text', class="ng-hide", name="{{referenceName}}" ng-model="set")
	div(class="input-group reference-search")
		input(type="text", class="form-control",ng-model="search",ng-change="load(true)",placeholder=t12n("crud.bricks.reference.placeholder"))
		.input-group-btn
			button(type="button", class="btn btn-default dropdown-toggle", ng-click="dropdown()")
				span(class="caret",ng-hide="loading")
				span(class="glyphicon glyphicon-refresh",ng-show="loading",class="ng-hide")
			ul(class="dropdown-menu ng-hide", ng-show="opened", style="display:block;", scroll-end="more()",scroll-end-margin="50")
				li(class="reference", ng-repeat="(lk, l) in data.list", ng-click="addReference(l)",ng-class="{'selected':set.indexOf(l._id)>=0}")
					div(class="reference-img ng-hide",ng-show="l._img")
						img(ng-src="{{l._img.path}}")
					ul.reference-items
						li(ng-repeat="(vk,v) in l",class="reference-item reference-item-{{vk}}")
							strong.item-label {{vk}}
							span.item-value {{v}}
	ul(class="references")
		li(class="reference", ng-repeat="(lk, l) in references")
			div.reference-data
				div(class="reference-img ng-hide",ng-show="l._img")
					img(ng-src="{{l._img.path}}")
				ul.reference-items
					li(ng-repeat="(vk,v) in l",class="reference-item reference-item-{{vk}}")
						strong.item-label.col-sm-2 {{vk}}
						span.item-value.col-sm-10 {{v}}
			div.reference-controls
				button(class="btn btn-danger btn-remove pull-right", type='button', ng-click="addReference(l)")
					span(class="glyphicon glyphicon-remove")
					= " "+t12n("crud.bricks.reference.remove")
				.input-group.reference-sort-select
					span.input-group-addon
						span.glyphicon.glyphicon-sort
					select(class="form-control", ng-model="sorts[lk]", ng-change="moveReference(lk)",ng-options="ork as ork*1+1 for (ork, ore) in references")

mixin imagepicker
	div.current-file.imagebox
		img(ng-src="{{value.path}}" ng-hide="!value.path")
		input(type='file', class="", name="{{imagepickerName}}",ng-model="filePicker",  onchange="angular.element(this).scope().fileChange(this)")
	div.new-file
		//img(ng-repeat="(imgk, imgf) in readedFiles",ng-src="{{imgf}}")
		//imagedit(ng-repeat="(imgk, imgf) in readedFiles")

doctype html
html(lang=gw.language,ng-app="Pillars")
	head
		title= t12n("schemas."+schema.id+".title")
		meta(charset="utf-8")
		meta(http-equiv='X-UA-Compatible', content='IE=edge')
		meta(name="viewport", content="width=device-width, initial-scale=1")
		link(rel='stylesheet', href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css')
		link(rel='stylesheet', href='/css/pillars.css')
		//link(rel='stylesheet', href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css')

	body
		#space.container
			+navbar
			header#header
				h1= t12n("schemas."+schema.id+".h1")
				ul(class="notifier list-unstyled ng-hide", ng-show="msgs")
					li(ng-repeat="msg in msgs", class="alert alert-{{msg.lvl}}")
						strong {{msg.msg}}
						|  {{msg.details}}

			#page
				script(type="text/ng-template", id="crud-list.html")
					+crud-list
				script(type="text/ng-template", id="crud-editor.html")
					+crud-editor
				script(type="text/ng-template", id="bricks.datepicker.html")
					+datepicker
				script(type="text/ng-template", id="bricks.referencepicker.html")
					+referencepicker
				script(type="text/ng-template", id="bricks.imagepicker.html")
					+imagepicker
				div(ng-view)
				if trace
					.trace
						hr
						pre=trace

			footer#footer

		script(src='https://code.angularjs.org/snapshot/angular.min.js')
		script(src='https://code.angularjs.org/snapshot/i18n/angular-locale_'+gw.language+'.js')
		script(src='https://code.angularjs.org/snapshot/angular-route.min.js')
		//script(src='https://code.angularjs.org/snapshot/angular-animate.min.js')
		script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js')
		script(src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js')
		script(src='/js/kinetic-v5.1.0.min.js')
		script(src='/js/wysihtml5-advanced.js')
		script(src='/js/wysihtml5-0.4.0pre.js')
		script(src='/js/pillars.js')

