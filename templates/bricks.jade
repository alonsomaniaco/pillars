
mixin buttonlink(value,link)
	input(class='btn btn-default', type='button', value=value, onclick="window.location.href='"+link+"'")

mixin fieldset(fieldset)
	.form-horizontal
		each field in fieldset.fields
			- var tree = [fieldset.id];
			if field.template=='subset' || field.template=='list' 
				+#{field.template}(field,tree)
			else
				+field(field,tree)

mixin subset(subset,tree)
	- locals.depth++;
	- tree.push(subset.id);
	fieldset.pillar-subset
		legend
			#{'h'+(locals.depth+locals.headings)}.text-primary=subset.label
				small=' '+subset.details
		each field in subset.fields
			+field(field,tree)
	- locals.depth--;

mixin list(list,tree)
	- locals.depth++;
	- tree.push(list.id);
	.form-group
		label(class="control-label col-sm-2")=list.label
		div(class="container col-sm-10",style="background-color: #F7F7F7;border-radius: 20px;padding: 20px 25px;")
			p(class="help-block")=list.details
			fieldset(ng-repeat="lf in "+tree.join('.'))
				legend
					#{'h'+(locals.depth+locals.headings)}.text-primary
						= list.items.label
						small=' '+list.items.details
				each field in list.fields
					+field(field,tree.concat(['{{$index}}']))

				div(style="background-color: #F7F7F7;")
			
			input(class='btn btn-primary', type='button', value='Add',ng-click='addListItem('+tree.join('.')+')')

	- locals.depth--;

mixin field(field,tree)
	- tree.push(field.id);
	- var id = tree.join('.');
	.form-group
		label(class="control-label col-sm-2",for=id)=field.label
		div(class="col-sm-10")
			if field.i18n
				+field-i18n(field,tree)
			else
				+#{field.template}(field,tree)
			p.help-block=field.details

mixin field-i18n(field,tree)
	.pillar-langfields
		each lang in gw.textualization.langs
			- var classes = [];
			- classes.push('lang-'+lang);
			- if(gw.language==lang){classes.push('lang-active');}
			- if(gw.textualization.langs[0]==lang){classes.push('lang-default');}
			+#{field.template}(field,tree.concat([lang]),classes)

mixin text(field,tree,classes)
	- var id = tree.join('.');
	- var name = tree.slice(0,1)+'['+tree.slice(1).join('][')+']';
	- var value = tree.join('.');
	- var match = value.lastIndexOf('}')+1;
	- value = value.slice(match);
	- if(match>0){value = 'lf'+value;}
	- value = value;
	input(type='text', class=classes, class=['form-control','field-text'], id=id, name=name, ng-model=value)
	span(ng-model=value)

mixin textarea(field,tree,classes)
	- var id = tree.join('.');
	- var name = tree.slice(0,1)+'['+tree.slice(1).join('][')+']';
	- var value = tree.join('.');
	- var match = value.lastIndexOf('}')+1;
	- value = value.slice(match);
	- if(match>0){value = 'lf'+value;}
	- value = value;
	textarea(class=classes, class=['form-control','field-textarea'], id=id, name=name, ng-model=value)
	span(ng-model=value)


